<!DOCTYPE html>
<html lang="en-us">
<head>
   <meta charset="UTF-8">
   
   <title>pyromasters-multiplayer - game.html</title>

   <link rel="stylesheet" href="/css/game.css">
   
   <script src="socket.io/socket.io.min.js"></script>
   <script src="howler.js/howler.js"></script>

   <script src="js/misc.js"></script>
   <script src="js/log.js"></script>

   <script src="js/game/index.js"></script>
   <script src="js/game/misc.js"></script>
   <script src="js/game/consts.js"></script>
   <script src="js/game/game-socket.js"></script>
   <script src="js/game/movement.js"></script>
   <script src="js/game/game.js"></script>

   <script>
      const params = new URLSearchParams(window.location.search);
      const usernameHTML = params.get('username');
      const roomHTML = params.get('room');
      
      socket.emit('playerJoined', usernameHTML, roomHTML, (players, colorsCoords, map1, roomStatus) => {
         map = map1
         
         players.forEach( ({username, color, isOwner}) => {
            addPlayerToList(username, color, isOwner)
         });

         Object.keys(colorsCoords).forEach((color) => {
            coords[color] = colorsCoords[color]
         })

         if (roomStatus === ROOM_STATUS.WAITING || roomStatus === ROOM_STATUS.STARTING || roomStatus === ROOM_STATUS.ENDED)
            sounds.menu.play();
         })
   </script>
</head>

<body>
   <span id="loading" style="font-size: large; font-weight: bold;">LOADING...</span>

   <div id="chat"></div>

   <input id="chat-input">
   <script>
      const chatInput = document.querySelector('#chat-input');
   </script>
   <button id="chat-send-message" onclick="socket.emit('chat', chatInput.value);   chatInput.value = '';">Send msg</button>

   <canvas id="canvas" width="815" height="620" style="display: inline-block;"></canvas>

   <div id="log" style="display: inline; position: absolute;"></div>

   <ul id="player-list" style="display: inline-block; background-color: #bfb4b4; padding-top: 5px; padding-bottom: 5px; padding-right: 5px; font-size: 30px;"></ul>

   <br>set volume:
   <input type="range" min="0" max="100" value="30" id="volumeSlider">

   <script>
      const slider = document.querySelector('#volumeSlider');
      slider.addEventListener('input', () => {
         Object.values(sounds).forEach((sound) => {
            if (Array.isArray(sound)) {
               sound.forEach((sound) => {
                  sound.volume(slider.value / 100);
               })
            }
            else
               sound.volume(slider.value / 100);
         });
      });
   </script>

   <div id="start-game">
      <button id="start-button" onclick="socket.emit('tryStart')">Start game</button>
      <span id="room-status" style="color: red;"></span>
   </div>
   <br>

   <label hidden for="fps">Enter fps limit:</label>
   <input hidden value="60" id="fps">

   <div id="select-color" style="color: black; font-weight: bold;">
      <u><b><i>
         <span style="color: red;">Select</span>
         <span style="color: aqua;">color</span>
         <span style="color: blue;">here:</span></i></b></u><br>
      <button id="white" class="color-button" onclick="socket.emit('selectColor', 'white')">WHITE</button>
      <button id="black" class="color-button" onclick="socket.emit('selectColor', 'black')">BLACK</button>
      <button id="orange" class="color-button" onclick="socket.emit('selectColor', 'orange')">ORANGE</button>
      <button id="green" class="color-button" onclick="socket.emit('selectColor', 'green')">GREEN</buttton>
      <button id="spectator" class="color-button" onclick="socket.emit('selectColor', 'spectator')">SPECTATOR</buttton>
   </div>

   <p>You can move with W A S D. Place bombs with P.</p>
   <p><b>!! If you use a dark theme extension, disable it.</b></p>

   <button ontouchstart="keys.a = 1" ontouchend="keys.a = 0" class="android-button">LEFT <<<< (ANDROID)</button>
   <button ontouchstart="keys.d = 1" ontouchend="keys.d = 0" class="android-button">RIGHT >>>> (ANDROID)</button>
   <button ontouchstart="keys.w = 1" ontouchend="keys.w = 0" class="android-button">UP ^^^^ (ANDROID)</button>
   <button ontouchstart="keys.s = 1" ontouchend="keys.s = 0" class="android-button">DOWN vvvv (ANDROID)</button>
   <button ontouchstart="keys.p = 1" ontouchend="keys.p = 0" class="android-button">BOMB !!!! (ANDROID)</button>
</body>
</html>